"use client";

import Dropzone from "react-dropzone";
import styles from "./dropzone.module.scss";
import clsx from "clsx";
import {
  CloudUpload,
  Coronavirus,
  CheckmarkFilled,
  WhitePaper,
} from "@carbon/icons-react";
import { useState } from "react";
import { checkMalware } from "@/app/api";

export default function MalwareDropzone() {
  const [malwareFile, setMalwareFile] = useState<any>(null);
  const [indices, setIndices] = useState<any[]>([]);

  const submitMalware = async () => {
    if (malwareFile) {
      const response = await checkMalware(malwareFile);
      setIndices(response.indices);
    }
  };

  const resetStates = () => {
    setMalwareFile(null);
    setIndices([]);
  }

  return (
    <>
      {indices.length > 0 ? (
        <div
          className={clsx(
            styles.checkMode,
            styles.center,
            indices[0] === 0 && styles.legitimate
          )}
        >
          {indices[0] === 0 ? (
            <>
              <CheckmarkFilled size={60} />
              <p>File is Legitimate</p>
            </>
          ) : (
            <>
              <Coronavirus size={60} />
              <p>Malware Detected</p>
            </>
          )}
          <div className={clsx(styles.checkBtn, styles.recheckBtn)} onClick={resetStates}>
            Check another file
          </div>
        </div>
      ) : (
        <div className={clsx(styles.uploadMode, styles.center)}>
          <div className={styles.dropzoneContainer}>
            <Dropzone
              onDrop={(acceptedFiles) => setMalwareFile(acceptedFiles[0])}
              multiple={false}
            >
              {({ getRootProps, getInputProps }) => (
                <div
                  {...getRootProps()}
                  className={clsx(styles.dropZone, styles.center)}
                >
                  <input {...getInputProps()} />
                  {malwareFile ? (
                    <>
                      <WhitePaper size={60} /> <p>{malwareFile.name}</p>
                    </>
                  ) : (
                    <>
                      <CloudUpload size={60} />{" "}
                      <p>
                        Drag & drop a file here, or click to select a file
                      </p>
                    </>
                  )}
                </div>
              )}
            </Dropzone>
          </div>
          <div
            className={clsx(styles.checkBtn, !malwareFile && styles.disabled)}
            onClick={submitMalware}
          >
            Check this malware
          </div>
        </div>
      )}
    </>
  );
}
